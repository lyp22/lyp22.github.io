---
published: true
title: Opencv的卸载并安装2.4版本(无cuda+cuda9.0)
category: opencv
tags: 
  - 常用
layout: post
---



# 查看安装的opencv版本

```
pkg-config --modversion opencv
```

# 卸载旧版本opencv

进入到原来安装opencv的build目录，执行卸载操作：

```
cd opencv-3.2.0/build
sudo make uninstall
cd ..
sudo rm -r build
 
sudo rm -r /usr/local/include/opencv2 /usr/local/include/opencv /usr/include/opencv /usr/include/opencv2 /usr/local/share/opencv /usr/local/share/OpenCV /usr/share/opencv /usr/share/OpenCV /usr/local/bin/opencv* /usr/local/lib/libopencv*
 
cd /usr
sudo find . -name "*opencv*" | xargs sudo rm -rf
```


# 安装opencv2.4

1. 先从sourceforge上下载OpenCV的源码



http://jaist.dl.sourceforge.net/project/opencvlibrary/opencv-unix/2.4.9/opencv-2.4.9.zip


2. 解压到任意目录



unzip opencv-2.4.9.zip



3. 进入源码目录，创建release目录



cd opencv-2.4.9

mkdir release  



4. 可以看到在OpenCV目录下，有个CMakeLists.txt文件，需要事先安装一些软件



sudo apt-get install build-essential cmake libgtk2.0-dev pkg-config python-dev python-numpy libavcodec-dev libavformat-dev libswscale-dev  


5.  进入release目录，安装OpenCV是所有的文件都会被放到这个release目录下



cd release  



6. cmake编译OpenCV源码，安装所有的lib文件都会被安装到/usr/local目录下

不要cuda

```

cmake -D CMAKE_BUILD_TYPE=RELEASE -D CMAKE_INSTALL_PREFIX=/usr/local -D WITH_CUDA=OFF ..
```

不要ffmpeg

```
cmake -D CMAKE_BUILD_TYPE=RELEASE -D CMAKE_INSTALL_PREFIX=/usr/local -D WITH_CUDA=OFF -D WITH_FFMPEG=OFF ..
```

7. 安装


sudo make install -j8


# 强行将opencv2.4适配cuda9.0（cuda9.0不支持2.0架构）

解决方案如下：

1）.找到FindCUDA.cmake文件

找到行

find_cuda_helper_libs(nppi)

改为

```
  find_cuda_helper_libs(nppial)
  find_cuda_helper_libs(nppicc)
  find_cuda_helper_libs(nppicom)
  find_cuda_helper_libs(nppidei)
  find_cuda_helper_libs(nppif)
  find_cuda_helper_libs(nppig)
  find_cuda_helper_libs(nppim)
  find_cuda_helper_libs(nppist)
  find_cuda_helper_libs(nppisu)
  find_cuda_helper_libs(nppitc)
```

2）.找到行

set(CUDA_npp_LIBRARY "${CUDA_nppc_LIBRARY};${CUDA_nppi_LIBRARY};${CUDA_npps_LIBRARY}")

改为

```
set(CUDA_npp_LIBRARY "${CUDA_nppc_LIBRARY};${CUDA_nppial_LIBRARY};${CUDA_nppicc_LIBRARY};${CUDA_nppicom_LIBRARY};${CUDA_nppidei_LIBRARY};${CUDA_nppif_LIBRARY};${CUDA_nppig_LIBRARY};${CUDA_nppim_LIBRARY};${CUDA_nppist_LIBRARY};${CUDA_nppisu_LIBRARY};${CUDA_nppitc_LIBRARY};${CUDA_npps_LIBRARY}")
```

3）.找到行

unset(CUDA_nppi_LIBRARY CACHE)

改为

```
unset(CUDA_nppial_LIBRARY CACHE)
unset(CUDA_nppicc_LIBRARY CACHE)
unset(CUDA_nppicom_LIBRARY CACHE)
unset(CUDA_nppidei_LIBRARY CACHE)
unset(CUDA_nppif_LIBRARY CACHE)
unset(CUDA_nppig_LIBRARY CACHE)
unset(CUDA_nppim_LIBRARY CACHE)
unset(CUDA_nppist_LIBRARY CACHE)
unset(CUDA_nppisu_LIBRARY CACHE)
unset(CUDA_nppitc_LIBRARY CACHE)
```

4）.找到文件OpenCVDetectCUDA.cmake

修改以下几行

```
 ...
  set(__cuda_arch_ptx "")
  if(CUDA_GENERATION STREQUAL "Fermi")
    set(__cuda_arch_bin "2.0")
  elseif(CUDA_GENERATION STREQUAL "Kepler")
    set(__cuda_arch_bin "3.0 3.5 3.7")
  ...
```

改为

```
  ...
  set(__cuda_arch_ptx "")
  if(CUDA_GENERATION STREQUAL "Kepler")
    set(__cuda_arch_bin "3.0 3.5 3.7")
  elseif(CUDA_GENERATION STREQUAL "Maxwell")
    set(__cuda_arch_bin "5.0 5.2")
  ...
```


5）.cuda9中有一个单独的halffloat(cuda_fp16.h)头文件,也应该被包括在opencv的目录里

将头文件cuda_fp16.h添加至 opencv\modules\cudev\include\opencv2\cudev\common.hpp

即在common.hpp中添加

```
#include <cuda_fp16.h>
```

重新生成即可

